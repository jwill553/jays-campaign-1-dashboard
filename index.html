<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DnD Campaign Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #8b5cf6;
            --secondary: #ec4899;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --ally: #22c55e;
            --neutral: #eab308;
            --hostile: #dc2626;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 10px;
            padding-bottom: 80px;
        }

        @media (min-width: 768px) {
            body {
                padding: 20px;
                padding-bottom: 20px;
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .nav-tabs::-webkit-scrollbar {
            height: 4px;
        }

        .nav-tabs::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }

        .nav-tabs::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 2px;
        }

        .nav-tab {
            padding: 12px 20px;
            background: rgba(255,255,255,0.05);
            border: none;
            border-radius: 10px;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: rgba(139, 92, 246, 0.2);
            color: var(--text);
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
        }

        .tab-icon {
            font-size: 1.2em;
        }

        /* Page containers */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
            position: relative;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .header {
                padding: 30px;
                margin-bottom: 30px;
            }
        }

        .header::before {
            content: 'üêâ';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 60px;
            opacity: 0.1;
        }

        @media (min-width: 768px) {
            .header::before {
                right: 20px;
                font-size: 100px;
            }
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        @media (min-width: 768px) {
            .header h1 {
                font-size: 2.5em;
                margin-bottom: 10px;
            }
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .header-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        @media (min-width: 768px) {
            .header-stats {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
                margin-top: 20px;
            }
        }

        .header-stat {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        @media (min-width: 768px) {
            .header-stat {
                padding: 15px;
            }
        }

        .header-stat-label {
            font-size: 0.75em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        @media (min-width: 768px) {
            .header-stat-label {
                font-size: 0.9em;
            }
        }

        .header-stat-value {
            font-size: 1.5em;
            font-weight: bold;
        }

        @media (min-width: 768px) {
            .header-stat-value {
                font-size: 1.8em;
            }
        }

        /* Grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        @media (min-width: 768px) {
            .card {
                padding: 25px;
            }
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.2);
        }

        @media (max-width: 767px) {
            .card:hover {
                transform: none;
            }
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        @media (min-width: 768px) {
            .card-header {
                margin-bottom: 20px;
                padding-bottom: 15px;
            }
        }

        .card-title {
            font-size: 1.2em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (min-width: 768px) {
            .card-title {
                font-size: 1.4em;
                gap: 10px;
            }
        }

        .card-icon {
            font-size: 1.3em;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        /* Quest items */
        .quest-item {
            background: rgba(139, 92, 246, 0.1);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 12px;
            border-left: 4px solid var(--primary);
        }

        @media (min-width: 768px) {
            .quest-item {
                padding: 15px;
                margin-bottom: 15px;
            }
        }

        .quest-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .quest-name {
            font-weight: 600;
            font-size: 1em;
            flex: 1;
            min-width: 0;
        }

        .priority-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .priority-high {
            background: var(--danger);
            color: white;
        }

        .priority-medium {
            background: var(--warning);
            color: white;
        }

        .priority-low {
            background: var(--success);
            color: white;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.5s ease;
        }

        /* NPC items */
        .npc-list {
            display: grid;
            gap: 10px;
        }

        .npc-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            border-left: 4px solid;
            transition: background 0.3s;
        }

        .npc-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .npc-ally {
            border-left-color: var(--ally);
        }

        .npc-neutral {
            border-left-color: var(--neutral);
        }

        .npc-hostile {
            border-left-color: var(--hostile);
        }

        .npc-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            flex-shrink: 0;
        }

        .npc-info {
            flex: 1;
        }

        .npc-name {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .npc-role {
            font-size: 0.9em;
            color: var(--text-muted);
        }

        /* Stats grid */
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        @media (min-width: 768px) {
            .stat-grid {
                gap: 15px;
            }
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 10px;
        }

        @media (min-width: 768px) {
            .stat-item {
                padding: 20px;
            }
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.85em;
            color: var(--text-muted);
        }

        /* Timeline */
        .session-timeline {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .session-timeline::-webkit-scrollbar {
            width: 8px;
        }

        .session-timeline::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }

        .session-timeline::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .timeline-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }

        .timeline-marker {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .timeline-date {
            font-size: 0.85em;
            color: var(--text-muted);
        }

        /* Loading and errors */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: var(--text-muted);
        }

        .setup-instructions {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        @media (min-width: 768px) {
            .setup-instructions {
                padding: 20px;
                margin-bottom: 20px;
            }
        }

        .setup-instructions h3 {
            margin-bottom: 10px;
            color: var(--success);
            font-size: 1.1em;
        }

        .setup-instructions ol {
            margin-left: 18px;
            line-height: 1.6;
            font-size: 0.9em;
        }

        @media (min-width: 768px) {
            .setup-instructions ol {
                margin-left: 20px;
                line-height: 1.8;
                font-size: 1em;
            }
        }

        #sheetUrlInput {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--card-bg);
            color: var(--text);
            font-size: 0.9em;
        }

        /* Buttons */
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
            width: 100%;
            touch-action: manipulation;
        }

        @media (min-width: 768px) {
            button {
                width: auto;
                padding: 10px 20px;
            }
        }

        button:hover {
            background: var(--secondary);
        }

        button:active {
            transform: scale(0.98);
        }

        /* Bottom navigation (mobile) */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 10px;
            z-index: 1000;
        }

        @media (min-width: 768px) {
            .bottom-nav {
                display: none;
            }
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 8px 12px;
            font-size: 0.75em;
            width: auto;
            transition: color 0.3s;
        }

        .bottom-nav-item.active {
            color: var(--primary);
        }

        .bottom-nav-icon {
            font-size: 1.5em;
        }

        /* Notification badge */
        .notification-badge {
            position: relative;
        }

        .notification-badge::after {
            content: '';
            position: absolute;
            top: -4px;
            right: -4px;
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            display: none;
        }

        .notification-badge.has-notification::after {
            display: block;
        }

        /* Refresh button */
        .refresh-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            z-index: 999;
            touch-action: manipulation;
        }

        @media (min-width: 768px) {
            .refresh-btn {
                bottom: 30px;
                right: 30px;
                width: 60px;
                height: 60px;
                font-size: 1.5em;
            }
        }

        .refresh-btn:active {
            transform: scale(0.95);
        }

        /* Party member cards */
        .party-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .party-member-card {
            background: rgba(139, 92, 246, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid var(--border);
            transition: border-color 0.3s;
        }

        .party-member-card:hover {
            border-color: var(--primary);
        }

        .party-member-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .party-avatar-large {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
        }

        .party-member-info h3 {
            margin-bottom: 4px;
        }

        .party-member-class {
            color: var(--text-muted);
            font-size: 0.9em;
        }

        .party-member-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .party-stat {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .party-stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--primary);
        }

        .party-stat-label {
            font-size: 0.8em;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Notification toast */
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            border: 2px solid var(--primary);
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            z-index: 10000;
            display: none;
            max-width: 350px;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-toast.show {
            display: block;
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .notification-icon {
            font-size: 1.5em;
        }

        .notification-title {
            font-weight: 600;
            flex: 1;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.2em;
            padding: 0;
            width: auto;
        }

        .notification-body {
            color: var(--text-muted);
            font-size: 0.9em;
        }

        /* Location cards */
        .location-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .location-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            border-left: 4px solid var(--primary);
            transition: transform 0.3s;
        }

        .location-card:hover {
            transform: translateX(5px);
        }

        .location-name {
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .location-type {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            background: rgba(139, 92, 246, 0.2);
            color: var(--primary);
            margin-bottom: 10px;
        }

        .location-description {
            font-size: 0.9em;
            color: var(--text-muted);
            line-height: 1.4;
        }

        /* Combat tracker */
        .combat-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .combat-entry {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .combat-info {
            flex: 1;
        }

        .combat-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .combat-details {
            font-size: 0.85em;
            color: var(--text-muted);
        }

        .combat-count {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary);
            min-width: 60px;
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Setup Instructions -->
        <div id="setupInstructions" class="setup-instructions">
            <h3>üîß Setup Required: Connect to Google Sheets</h3>
            <ol>
                <li>Open your Campaign Tracker Google Sheet</li>
                <li>Click <strong>Extensions ‚Üí Apps Script</strong></li>
                <li>Create a new script and paste the deployment code (see console)</li>
                <li>Deploy as Web App (Anyone with link can access)</li>
                <li>Copy the Web App URL and paste it below</li>
            </ol>
            <input type="text" id="sheetUrlInput" placeholder="Paste your Google Sheets Web App URL here">
            <button onclick="saveSheetUrl()">Connect to Sheet</button>
            <br><br>
            <label>
                <input type="checkbox" id="enableNotifications" onchange="requestNotificationPermission()">
                Enable push notifications for new sessions
            </label>
        </div>

        <!-- Desktop Navigation -->
        <div class="nav-tabs" id="desktopNav">
            <button class="nav-tab active" onclick="switchPage('overview')">
                <span class="tab-icon">üìä</span>
                <span>Overview</span>
            </button>
            <button class="nav-tab" onclick="switchPage('party')">
                <span class="tab-icon">üë•</span>
                <span>Party</span>
            </button>
            <button class="nav-tab" onclick="switchPage('world')">
                <span class="tab-icon">üó∫Ô∏è</span>
                <span>World</span>
            </button>
            <button class="nav-tab" onclick="switchPage('analytics')">
                <span class="tab-icon">üìà</span>
                <span>Analytics</span>
            </button>
            <button class="nav-tab notification-badge" id="notificationTab" onclick="switchPage('notifications')">
                <span class="tab-icon">üîî</span>
                <span>Notifications</span>
            </button>
        </div>

        <!-- Page: Overview -->
        <div id="overview" class="page active">
            <div class="header">
                <h1 id="campaignName">Campaign Dashboard</h1>
                <p id="campaignArc">Loading campaign data...</p>
                <div class="header-stats">
                    <div class="header-stat">
                        <div class="header-stat-label">Total Sessions</div>
                        <div class="header-stat-value" id="totalSessions">-</div>
                    </div>
                    <div class="header-stat">
                        <div class="header-stat-label">Party Level</div>
                        <div class="header-stat-value" id="partyLevel">-</div>
                    </div>
                    <div class="header-stat">
                        <div class="header-stat-label">Total XP Awarded</div>
                        <div class="header-stat-value" id="totalXP">-</div>
                    </div>
                    <div class="header-stat">
                        <div class="header-stat-label">Party Gold</div>
                        <div class="header-stat-value" id="partyGold">-</div>
                    </div>
                </div>
            </div>

            <div class="grid">
                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üéØ</span>
                            Active Quests
                        </div>
                    </div>
                    <div id="questList">
                        <div class="loading">Loading quests...</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üë•</span>
                            Notable NPCs
                        </div>
                    </div>
                    <div id="npcList" class="npc-list">
                        <div class="loading">Loading NPCs...</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üìä</span>
                            Campaign Stats
                        </div>
                    </div>
                    <div class="stat-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="npcCount">-</div>
                            <div class="stat-label">NPCs Met</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="questCount">-</div>
                            <div class="stat-label">Active Quests</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="allyCount">-</div>
                            <div class="stat-label">Allies</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="enemyCount">-</div>
                            <div class="stat-label">Enemies</div>
                        </div>
                    </div>
                </div>

                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üìÖ</span>
                            Recent Sessions
                        </div>
                    </div>
                    <div id="sessionTimeline" class="session-timeline">
                        <div class="loading">Loading sessions...</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üìà</span>
                            XP Progress
                        </div>
                    </div>
                    <canvas id="xpChart"></canvas>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">ü§ù</span>
                            NPC Relationships
                        </div>
                    </div>
                    <canvas id="npcChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Page: Party -->
        <div id="party" class="page">
            <div class="header">
                <h1>üé≠ Party Management</h1>
                <p>Track your adventuring party's progress and status</p>
            </div>

            <div class="grid">
                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üë•</span>
                            Party Members
                        </div>
                    </div>
                    <div id="partyMembersList" class="party-grid">
                        <div class="loading">Loading party members...</div>
                    </div>
                </div>

                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üí∞</span>
                            Party Inventory & Wealth
                        </div>
                    </div>
                    <div id="partyInventory">
                        <div class="loading">Loading inventory...</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üìä</span>
                            Class Distribution
                        </div>
                    </div>
                    <canvas id="classChart"></canvas>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">‚öîÔ∏è</span>
                            Combat Contributions
                        </div>
                    </div>
                    <canvas id="combatChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Page: World -->
        <div id="world" class="page">
            <div class="header">
                <h1>üó∫Ô∏è World Explorer</h1>
                <p>Locations, factions, and world impact</p>
            </div>

            <div class="grid">
                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üè∞</span>
                            Visited Locations
                        </div>
                    </div>
                    <div id="locationsList" class="location-grid">
                        <div class="loading">Loading locations...</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üåç</span>
                            World Impact Events
                        </div>
                    </div>
                    <div id="worldImpactList">
                        <div class="loading">Loading world events...</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">‚öîÔ∏è</span>
                            Faction Influence
                        </div>
                    </div>
                    <canvas id="factionChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Page: Analytics -->
        <div id="analytics" class="page">
            <div class="header">
                <h1>üìà Campaign Analytics</h1>
                <p>Deep dive into your campaign statistics</p>
            </div>

            <div class="grid">
                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">‚öîÔ∏è</span>
                            Combat Statistics
                        </div>
                    </div>
                    <div id="combatStatsList" class="combat-list">
                        <div class="loading">Loading combat stats...</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üí∞</span>
                            Gold Flow Over Time
                        </div>
                    </div>
                    <canvas id="goldChart"></canvas>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üìÖ</span>
                            Session Activity
                        </div>
                    </div>
                    <canvas id="sessionTypeChart"></canvas>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üé≤</span>
                            Loot Distribution
                        </div>
                    </div>
                    <canvas id="lootChart"></canvas>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üìä</span>
                            Player Attendance
                        </div>
                    </div>
                    <canvas id="attendanceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Page: Notifications -->
        <div id="notifications" class="page">
            <div class="header">
                <h1>üîî Notifications</h1>
                <p>Stay updated on campaign events</p>
            </div>

            <div class="grid">
                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üîî</span>
                            Recent Notifications
                        </div>
                    </div>
                    <div id="notificationsList">
                        <div class="loading">No notifications yet</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">‚öôÔ∏è</span>
                            Notification Settings
                        </div>
                    </div>
                    <div style="padding: 10px;">
                        <label style="display: block; margin-bottom: 15px;">
                            <input type="checkbox" id="notifyNewSession" checked>
                            New session posted
                        </label>
                        <label style="display: block; margin-bottom: 15px;">
                            <input type="checkbox" id="notifyQuestUpdate" checked>
                            Quest progress updates
                        </label>
                        <label style="display: block; margin-bottom: 15px;">
                            <input type="checkbox" id="notifyLevelUp" checked>
                            Level up notifications
                        </label>
                        <label style="display: block; margin-bottom: 15px;">
                            <input type="checkbox" id="notifyWorldEvent" checked>
                            Major world events
                        </label>
                        <button onclick="saveNotificationSettings()" style="margin-top: 10px;">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification Toast -->
        <div id="notificationToast" class="notification-toast">
            <div class="notification-header">
                <span class="notification-icon">üîî</span>
                <span class="notification-title" id="toastTitle">Notification</span>
                <button class="notification-close" onclick="closeToast()">√ó</button>
            </div>
            <div class="notification-body" id="toastBody">
                Message content goes here
            </div>
        </div>

        <!-- Mobile Bottom Navigation -->
        <div class="bottom-nav">
            <button class="bottom-nav-item active" onclick="switchPage('overview')">
                <span class="bottom-nav-icon">üìä</span>
                <span>Overview</span>
            </button>
            <button class="bottom-nav-item" onclick="switchPage('party')">
                <span class="bottom-nav-icon">üë•</span>
                <span>Party</span>
            </button>
            <button class="bottom-nav-item" onclick="switchPage('world')">
                <span class="bottom-nav-icon">üó∫Ô∏è</span>
                <span>World</span>
            </button>
            <button class="bottom-nav-item" onclick="switchPage('analytics')">
                <span class="bottom-nav-icon">üìà</span>
                <span>Stats</span>
            </button>
            <button class="bottom-nav-item notification-badge" onclick="switchPage('notifications')">
                <span class="bottom-nav-icon">üîî</span>
                <span>Alerts</span>
            </button>
        </div>

        <!-- Refresh Button -->
        <button class="refresh-btn" onclick="loadDashboard()" title="Refresh Data">üîÑ</button>
    </div>

    <script>
        // Configuration
        let SHEET_URL = localStorage.getItem('sheetUrl') || '';
        let lastSessionCount = parseInt(localStorage.getItem('lastSessionCount') || '0');
        let notificationSettings = JSON.parse(localStorage.getItem('notificationSettings') || '{"newSession":true,"questUpdate":true,"levelUp":true,"worldEvent":true}');
        
        // Check if setup is needed
        if (!SHEET_URL) {
            document.getElementById('setupInstructions').style.display = 'block';
        } else {
            document.getElementById('setupInstructions').style.display = 'none';
            loadDashboard();
            startNotificationPolling();
        }

        // Request notification permission
        function requestNotificationPermission() {
            if ('Notification' in window && document.getElementById('enableNotifications').checked) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        showToast('Notifications Enabled', 'You will receive updates about campaign events');
                    }
                });
            }
        }

        function saveSheetUrl() {
            const url = document.getElementById('sheetUrlInput').value.trim();
            if (url) {
                localStorage.setItem('sheetUrl', url);
                SHEET_URL = url;
                document.getElementById('setupInstructions').style.display = 'none';
                loadDashboard();
                startNotificationPolling();
            } else {
                alert('Please enter a valid URL');
            }
        }

        function saveNotificationSettings() {
            notificationSettings = {
                newSession: document.getElementById('notifyNewSession').checked,
                questUpdate: document.getElementById('notifyQuestUpdate').checked,
                levelUp: document.getElementById('notifyLevelUp').checked,
                worldEvent: document.getElementById('notifyWorldEvent').checked
            };
            localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
            showToast('Settings Saved', 'Notification preferences updated');
        }

        // Sample data
        const sampleData = {
            campaign: {
                name: "The Crimson Prophecy",
                arc: "Chapter 2: Shadows of the North",
                level: 7,
                sessions: 15
            },
            sessions: [
                { number: 15, title: "The Frozen Tomb", date: "2024-10-01", xp: 3500, type: "Combat" },
                { number: 14, title: "Betrayal at Blackwater", date: "2024-09-24", xp: 3200, type: "Roleplay" },
                { number: 13, title: "The Council's Decision", date: "2024-09-17", xp: 2800, type: "Roleplay" },
                { number: 12, title: "Rescue Mission", date: "2024-09-10", xp: 3800, type: "Combat" },
                { number: 11, title: "Into the Underdark", date: "2024-09-03", xp: 3400, type: "Exploration" }
            ],
            quests: [
                { name: "Stop the Lich King", status: "Active", priority: "High", progress: 65 },
                { name: "Find the Lost Artifact", status: "Active", priority: "High", progress: 40 },
                { name: "Rescue the Prisoners", status: "Active", priority: "Medium", progress: 80 },
                { name: "Investigate the Cult", status: "Active", priority: "Low", progress: 25 }
            ],
            npcs: [
                { name: "Thorin Ironforge", role: "Dwarven King", relationship: "Ally", avatar: "üëë" },
                { name: "Malachar the Dark", role: "Lich Lord", relationship: "Hostile", avatar: "üíÄ" },
                { name: "Elara Moonwhisper", role: "Elven Mage", relationship: "Ally", avatar: "üßô‚Äç‚ôÄÔ∏è" },
                { name: "Grimjaw", role: "Orc Warlord", relationship: "Hostile", avatar: "‚öîÔ∏è" },
                { name: "Bartok the Merchant", role: "Trader", relationship: "Neutral", avatar: "üí∞" }
            ],
            party: [
                { name: "Thorin", class: "Fighter", level: 7, hp: 68, maxHp: 75, avatar: "‚öîÔ∏è" },
                { name: "Elara", class: "Wizard", level: 7, hp: 42, maxHp: 45, avatar: "üîÆ" },
                { name: "Grimm", class: "Rogue", level: 7, hp: 51, maxHp: 55, avatar: "üó°Ô∏è" },
                { name: "Lyra", class: "Cleric", level: 7, hp: 58, maxHp: 60, avatar: "‚ú®" }
            ],
            locations: [
                { name: "Ironpeak", type: "City", description: "The dwarven capital built into the mountains" },
                { name: "Shadowfen Swamp", type: "Wilderness", description: "Dangerous marshlands filled with dark magic" },
                { name: "The Crimson Spire", type: "Dungeon", description: "An ancient tower where the Lich King resides" }
            ],
            gold: 4850,
            totalXP: 48500,
            combatStats: [
                { type: "Battles Won", count: 24 },
                { type: "Enemies Defeated", count: 127 },
                { type: "Boss Fights", count: 5 },
                { type: "Near Deaths", count: 8 }
            ]
        };

        // Page switching
        function switchPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            
            // Show selected page
            document.getElementById(pageName).classList.add('active');
            
            // Update desktop nav
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => {
                if (tab.textContent.toLowerCase().includes(pageName) || 
                    (pageName === 'notifications' && tab.id === 'notificationTab')) {
                    tab.classList.add('active');
                }
            });
            
            // Update mobile nav
            document.querySelectorAll('.bottom-nav-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                if (item.textContent.toLowerCase().includes(pageName.slice(0, 5))) {
                    item.classList.add('active');
                }
            });
        }

        // Notification functions
        function showToast(title, message) {
            const toast = document.getElementById('notificationToast');
            document.getElementById('toastTitle').textContent = title;
            document.getElementById('toastBody').textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 5000);
        }

        function closeToast() {
            document.getElementById('notificationToast').classList.remove('show');
        }

        function showNotificationBadge() {
            document.querySelectorAll('.notification-badge').forEach(badge => {
                badge.classList.add('has-notification');
            });
        }

        function hideNotificationBadge() {
            document.querySelectorAll('.notification-badge').forEach(badge => {
                badge.classList.remove('has-notification');
            });
        }

        function sendPushNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: 'üé≤',
                    badge: 'üêâ'
                });
            }
        }

        function startNotificationPolling() {
            setInterval(async () => {
                const data = await fetchGoogleSheetData() || sampleData;
                checkForNewSession(data);
            }, 60000); // Check every minute
        }

        function checkForNewSession(data) {
            const currentSessionCount = data.campaign.sessions;
            
            if (currentSessionCount > lastSessionCount && lastSessionCount > 0) {
                const latestSession = data.sessions[0];
                if (notificationSettings.newSession) {
                    showToast('New Session Posted!', `Session ${latestSession.number}: ${latestSession.title}`);
                    sendPushNotification('New DnD Session!', `${latestSession.title} has been posted`);
                    showNotificationBadge();
                    addNotificationToList('New Session', `Session ${latestSession.number}: ${latestSession.title}`, new Date());
                }
            }
            
            localStorage.setItem('lastSessionCount', currentSessionCount.toString());
            lastSessionCount = currentSessionCount;
        }

        function addNotificationToList(title, message, timestamp) {
            const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
            notifications.unshift({ title, message, timestamp: timestamp.toISOString() });
            localStorage.setItem('notifications', JSON.stringify(notifications.slice(0, 50))); // Keep last 50
            renderNotifications();
        }

        function renderNotifications() {
            const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
            const container = document.getElementById('notificationsList');
            
            if (notifications.length === 0) {
                container.innerHTML = '<div class="loading">No notifications yet</div>';
                return;
            }
            
            container.innerHTML = notifications.map(notif => {
                const date = new Date(notif.timestamp);
                return `
                    <div class="timeline-item">
                        <div class="timeline-marker">üîî</div>
                        <div class="timeline-content">
                            <div class="timeline-title">${notif.title}</div>
                            <div class="timeline-date">${notif.message}</div>
                            <div class="timeline-date">${date.toLocaleString()}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Load dashboard data
        async function loadDashboard() {
            try {
                const data = await fetchGoogleSheetData() || sampleData;
                renderDashboard(data);
            } catch (error) {
                console.error('Error loading dashboard:', error);
                renderDashboard(sampleData);
            }
        }

        async function fetchGoogleSheetData() {
            if (!SHEET_URL) return null;
            
            try {
                const response = await fetch(SHEET_URL);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching from Google Sheets:', error);
                return null;
            }
        }

        function renderDashboard(data) {
            // Update header
            document.getElementById('campaignName').textContent = data.campaign.name;
            document.getElementById('campaignArc').textContent = data.campaign.arc;
            document.getElementById('totalSessions').textContent = data.campaign.sessions;
            document.getElementById('partyLevel').textContent = data.campaign.level;
            document.getElementById('totalXP').textContent = data.totalXP.toLocaleString();
            document.getElementById('partyGold').textContent = data.gold + ' GP';

            // Render all sections
            renderQuests(data.quests);
            renderNPCs(data.npcs);
            updateStats(data);
            renderSessions(data.sessions);
            renderXPChart(data.sessions);
            renderNPCChart(data.npcs);
            renderPartyMembers(data.party);
            renderLocations(data.locations);
            renderCombatStats(data.combatStats);
            renderGoldChart(data.sessions);
            renderSessionTypeChart(data.sessions);
            renderNotifications();
        }

        function renderQuests(quests) {
            const container = document.getElementById('questList');
            container.innerHTML = quests.map(quest => `
                <div class="quest-item">
                    <div class="quest-header">
                        <div class="quest-name">${quest.name}</div>
                        <span class="priority-badge priority-${quest.priority.toLowerCase()}">${quest.priority}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${quest.progress}%"></div>
                    </div>
                    <div style="margin-top: 5px; font-size: 0.9em; color: var(--text-muted);">${quest.progress}% Complete</div>
                </div>
            `).join('');
        }

        function renderNPCs(npcs) {
            const container = document.getElementById('npcList');
            container.innerHTML = npcs.slice(0, 5).map(npc => `
                <div class="npc-item npc-${npc.relationship.toLowerCase()}">
                    <div class="npc-avatar">${npc.avatar}</div>
                    <div class="npc-info">
                        <div class="npc-name">${npc.name}</div>
                        <div class="npc-role">${npc.role} ‚Ä¢ ${npc.relationship}</div>
                    </div>
                </div>
            `).join('');
        }

        function updateStats(data) {
            document.getElementById('npcCount').textContent = data.npcs.length;
            document.getElementById('questCount').textContent = data.quests.length;
            document.getElementById('allyCount').textContent = data.npcs.filter(n => n.relationship === 'Ally').length;
            document.getElementById('enemyCount').textContent = data.npcs.filter(n => n.relationship === 'Hostile').length;
        }

        function renderSessions(sessions) {
            const container = document.getElementById('sessionTimeline');
            container.innerHTML = sessions.map(session => `
                <div class="timeline-item">
                    <div class="timeline-marker">${session.number}</div>
                    <div class="timeline-content">
                        <div class="timeline-title">${session.title}</div>
                        <div class="timeline-date">${session.date} ‚Ä¢ ${session.xp} XP ‚Ä¢ ${session.type}</div>
                    </div>
                </div>
            `).join('');
        }

        function renderPartyMembers(party) {
            const container = document.getElementById('partyMembersList');
            container.innerHTML = party.map(member => `
                <div class="party-member-card">
                    <div class="party-member-header">
                        <div class="party-avatar-large">${member.avatar}</div>
                        <div class="party-member-info">
                            <h3>${member.name}</h3>
                            <div class="party-member-class">Level ${member.level} ${member.class}</div>
                        </div>
                    </div>
                    <div class="party-member-stats">
                        <div class="party-stat">
                            <div class="party-stat-value">${member.hp}</div>
                            <div class="party-stat-label">HP</div>
                        </div>
                        <div class="party-stat">
                            <div class="party-stat-value">${member.maxHp}</div>
                            <div class="party-stat-label">Max HP</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderLocations(locations) {
            const container = document.getElementById('locationsList');
            container.innerHTML = locations.map(loc => `
                <div class="location-card">
                    <div class="location-name">${loc.name}</div>
                    <div class="location-type">${loc.type}</div>
                    <div class="location-description">${loc.description}</div>
                </div>
            `).join('');
        }

        function renderCombatStats(stats) {
            const container = document.getElementById('combatStatsList');
            container.innerHTML = stats.map(stat => `
                <div class="combat-entry">
                    <div class="combat-info">
                        <div class="combat-name">${stat.type}</div>
                    </div>
                    <div class="combat-count">${stat.count}</div>
                </div>
            `).join('');
        }

        // Chart rendering functions
        function renderXPChart(sessions) {
            const ctx = document.getElementById('xpChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sessions.map(s => `Session ${s.number}`),
                    datasets: [{
                        label: 'XP Awarded',
                        data: sessions.map(s => s.xp),
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: { color: '#f1f5f9' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });
        }

        function renderNPCChart(npcs) {
            const ctx = document.getElementById('npcChart').getContext('2d');
            const relationships = {
                Ally: npcs.filter(n => n.relationship === 'Ally').length,
                Neutral: npcs.filter(n => n.relationship === 'Neutral').length,
                Hostile: npcs.filter(n => n.relationship === 'Hostile').length
            };

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Allies', 'Neutral', 'Hostile'],
                    datasets: [{
                        data: [relationships.Ally, relationships.Neutral, relationships.Hostile],
                        backgroundColor: ['#22c55e', '#eab308', '#dc2626'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#f1f5f9', padding: 15 }
                        }
                    }
                }
            });
        }

        function renderGoldChart(sessions) {
            const ctx = document.getElementById('goldChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sessions.map(s => `S${s.number}`),
                    datasets: [{
                        label: 'Gold Earned',
                        data: sessions.map(() => Math.floor(Math.random() * 500) + 100),
                        backgroundColor: '#f59e0b',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: { color: '#f1f5f9' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });
        }

        function renderSessionTypeChart(sessions) {
            const ctx = document.getElementById('sessionTypeChart').getContext('2d');
            const types = {};
            sessions.forEach(s => {
                types[s.type] = (types[s.type] || 0) + 1;
            });

            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(types),
                    datasets: [{
                        data: Object.values(types),
                        backgroundColor: ['#ef4444', '#8b5cf6', '#10b981', '#f59e0b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#f1f5f9', padding: 15 }
                        }
                    }
                }
            });
        }

        // Initialize dashboard
        if (SHEET_URL) {
            loadDashboard();
        }

        // Setup instructions logging
        console.log(`
%cüé≤ DnD Campaign Dashboard Setup Instructions

%cTo connect this dashboard to your Google Sheets Campaign Tracker:

1. Open your Campaign Tracker spreadsheet
2. Go to Extensions ‚Üí Apps Script
3. Create a new script file and paste this code:

%cfunction doGet() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  
  // Get data from sheets
  const sessionSheet = ss.getSheetByName('Session Log');
  const npcSheet = ss.getSheetByName('NPC Database');
  const plotSheet = ss.getSheetByName('Plot Thread Tracker');
  const lootSheet = ss.getSheetByName('Loot & Economy');
  
  // Read session data
  const sessionData = sessionSheet.getDataRange().getValues();
  const sessions = sessionData.slice(1, 6).map(row => ({
    number: row[0],
    title: row[2],
    date: row[1],
    xp: row[8],
    type: row[13] || 'Mixed'
  })).reverse();
  
  // Read NPC data
  const npcData = npcSheet.getDataRange().getValues();
  const npcs = npcData.slice(1, 11).map(row => ({
    name: row[1],
    role: row[3],
    relationship: row[5],
    avatar: 'üë§'
  }));
  
  // Read quest data
  const plotData = plotSheet.getDataRange().getValues();
  const quests = plotData.slice(1).filter(row => row[4] === 'Active').map(row => ({
    name: row[1],
    status: row[4],
    priority: row[3],
    progress: row[5] || 0
  }));
  
  // Get party gold
  const lootData = lootSheet.getDataRange().getValues();
  const goldRow = lootData[lootData.length - 1];
  const gold = goldRow[7] || 0;
  
  // Calculate totals
  const totalSessions = sessionData.length - 1;
  const totalXP = sessionData.slice(1).reduce((sum, row) => sum + (row[8] || 0), 0);
  
  // Sample party data (customize this based on your needs)
  const party = [
    { name: "Character 1", class: "Fighter", level: 7, hp: 65, maxHp: 75, avatar: "‚öîÔ∏è" },
    { name: "Character 2", class: "Wizard", level: 7, hp: 40, maxHp: 45, avatar: "üîÆ" },
    { name: "Character 3", class: "Rogue", level: 7, hp: 50, maxHp: 55, avatar: "üó°Ô∏è" },
    { name: "Character 4", class: "Cleric", level: 7, hp: 55, maxHp: 60, avatar: "‚ú®" }
  ];
  
  // Sample location data (customize based on your world)
  const locations = [
    { name: "Capital City", type: "City", description: "The kingdom's capital" },
    { name: "Dark Forest", type: "Wilderness", description: "A dangerous forest" },
    { name: "Ancient Ruins", type: "Dungeon", description: "Mysterious ruins" }
  ];
  
  // Sample combat stats (you can track this in another sheet)
  const combatStats = [
    { type: "Battles Won", count: 24 },
    { type: "Enemies Defeated", count: 127 },
    { type: "Boss Fights", count: 5 },
    { type: "Near Deaths", count: 8 }
  ];
  
  const result = {
    campaign: {
      name: "Your Campaign Name",
      arc: "Current Arc",
      level: 7,
      sessions: totalSessions
    },
    sessions: sessions,
    npcs: npcs,
    quests: quests,
    gold: gold,
    totalXP: totalXP,
    party: party,
    locations: locations,
    combatStats: combatStats
  };
  
  return ContentService.createTextOutput(JSON.stringify(result))
    .setMimeType(ContentService.MimeType.JSON);
}

%c4. Click Deploy ‚Üí New Deployment
5. Choose "Web app"
6. Set "Who has access" to "Anyone"
7. Click Deploy
8. Copy the Web App URL
9. Paste it into the dashboard and click "Connect to Sheet"
10. Enable notifications to get alerts for new sessions!

%cüîî Push Notifications Feature:
- Get notified when new sessions are posted
- Receive alerts for quest updates
- Stay informed about major world events
- Works on desktop and mobile (with permission)

%cNeed help? The dashboard will work with sample data until you connect your sheet!
        `, 
        'color: #8b5cf6; font-size: 20px; font-weight: bold;',
        'color: #f1f5f9; font-size: 14px;',
        'color: #22c55e; font-size: 12px; background: #0f172a; padding: 10px; border-radius: 5px; font-family: monospace;',
        'color: #f1f5f9; font-size: 14px;',
        'color: #ec4899; font-size: 14px; font-weight: bold;',
        'color: #10b981; font-size: 14px;',
        'color: #f59e0b; font-size: 14px; font-weight: bold;'
        );
    </script>
</body>
</html>